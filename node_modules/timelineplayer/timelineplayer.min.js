// TimelinePlayer.js - https://github.com/thunder9/timelineplayer.js
(function(t){var i=t._||require("underscore"),e=function(t,e){this.sequence=i.isArray(t)?t:[],this.callback=i.isFunction(e)?e:function(){},this.position=0,this._speed=1,this._muted=!1,s.push(this)};i.extend(e.prototype,{play:function(t,e){this._timeout&&this.stop(),i.isNumber(t)&&(this.position=t),e>0&&(this._speed=e),this._startPosition=this.position,this._startTime=Date.now(),this._timeout=null,o(this)},stop:function(){this.pause(),this.position=0},pause:function(){this._timeout&&clearTimeout(this._timeout),this._timeout=null;var t=Date.now()-this._startTime;this.position=this._startPosition+t*this._speed},setSpeed:function(t){return t>0?(this._timeout?(this.pause(),this.play(null,t)):this._speed=t,void 0):(this.stop(),void 0)},mute:function(){this._muted=!0},unmute:function(){this._muted=!1}});var o=function(t){var e=t.position,s=Date.now()-t._startTime;t.position=t._startPosition+s*t._speed;var n=i.find(t.sequence,function(i){return i[0]>t.position});if(n){var u=(n[0]-t.position)/t._speed;t._timeout=setTimeout(o,u,t)}if(!t._muted){var r=e===t.position?function(i){return i[0]===t.position}:function(i){return i[0]>e&&i[0]<=t.position};i.each(i.filter(t.sequence,r),function(i){t.callback.call(t,t.position,i)})}},s=[];i.each(i.keys(e.prototype),function(t){e[t]=function(){var e=i.toArray(arguments);i.each(s,function(i){i[t].apply(i,e)})}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.TimelinePlayer=e):t.TimelinePlayer=e})(this);